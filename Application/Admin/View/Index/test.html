<extend name="Public/base" />
<block name="body">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="__STATIC__/bootstrap/js/bootstrap.min.js"></script>
    <style type="text/css">
    .main { background: #fff; }

    .imgs-wrapper { height: auto; }
    .imgs-wrapper .img-item { width: 120px; height: 120px; position: relative; float: left; border: 1px solid #e5e5e5; margin-right: 20px; margin-top: 16px; cursor: pointer; margin-bottom: 4px; }
    .imgs-wrapper .img-item img { max-width: 100%; position: absolute; left: 50%; top: 50%; transform: translate3d(-50%, -50%, 0); }
    .imgs-wrapper .img-item .remove { position: absolute; right: -10px; top: -10px; font-size: 12px; display: none; color: #fff; background: #337ab7; padding: 6px; border-radius: 50%; }
    .imgs-wrapper .img-item.active { border-color: #337ab7; }
    .imgs-wrapper .img-item.active .remove { display: block; }

    .group-classify { font-size: 0; }
    .group-classify .item { display: inline-block; font-size: 14px; padding: 5px 15px; border-radius: 5px; color: #000; margin-right: 2px; cursor: pointer; }
    .group-classify .item.active, .group-classify .item:hover { background: #337ab7; color: #fff; text-decoration: none; }
    </style>
    <div class="main-title cf">
        <h2>
            添加公众号
        </h2>
    </div>
    <!-- 标签页导航 -->
    <div class="tab-wrap">
        <div class="tab-content">
            <form method='post' id="form1" class='form-horizontal' name="form1" action="{:US('Admin/Wp/insert')}"  enctype="multipart/form-data">
                <div class="form-item cf">
                    <label class="item-label">微信号<span class="check-tips"></span></label>
                    <div class="controls">
                        <input type="text" class="text input-large" name="account" id="account" value="">  <span class="must">*</span> <a class="btn" id="checkaccount" href="javascript:;">检测</a>
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">名称<span class="check-tips">（公众号名称）</span></label>
                    <div class="controls">
                        <input type="text" class="text input-large" name="title" id="title" value=""><span class="must">*</span>
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">biz<span class="check-tips"></span></label>
                    <div class="controls">
                        <input type="text" class="text input-large" name="biz" id="biz" value="">  <span class="must">*</span>
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">分类<span class="check-tips"></span></label>
                    <div class="controls">
                        <select name="catid" class="_one_cateid">
                            <option value ="" selected>请选择</option>
                            <volist name="catlist" id="vo">
                                <option value ="{$vo.id}">{$vo.title}</option>
                            </volist>
                        </select>
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">小图标<span class="check-tips"></span></label>
                    <div class="controls">
                        <input type="file" id="upload_picture_icon">
                        <input type="hidden" name="icon" id="cover_id_icon" value="{$info.icon|default=''}"/>
                        <div class="upload-img-box">
                            <notempty name="info['icon']"><div class="upload-pre-item"><img src="{$info.icon}"/></div></notempty>
                        </div>
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">二维码<span class="check-tips"></span></label>
                    <div class="controls">
                        <input type="file" id="upload_picture_qrcode">
                        <input type="hidden" name="qrcode" id="cover_id_qrcode" value="{$info.qrcode|default=''}"/>
                        <div class="upload-img-box">
                            <notempty name="info['qrcode']"><div class="upload-pre-item"><img src="{$info.qrcode}"/></div></notempty>
                        </div>
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">QQ<span class="check-tips"></span></label>
                    <div class="controls">
                        <input type="text" class="text input-large" name="qq"  value="">
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">订阅量<span class="check-tips"></span></label>
                    <div class="controls">
                        <input type="text" class="text input-large" name="static_cloud"  value="100">
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">介绍<span class="check-tips"></span></label>
                    <div class="controls">
                        <label class="textarea input-large">
                            <textarea name="content" id="content"></textarea>
                        </label>
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">发布时间<span class="check-tips"></span></label>
                    <div class="controls">
                        <input type="text" class="text input-large" name="release_time" id="datetimepicker" value="<?php echo date('Y-m-d H:i:s')?>">
                    </div>
                </div>
                <div class="form-item cf">
                    <label class="item-label">状态<span class="check-tips"></span></label>
                    <div class="controls">
                        <select name="status" >
                            <option value="0">审核</option>
                            <option value="1">启用</option>
                            <option value="2">禁用</option>
                        </select>
                    </div>
                </div>
                <div class="form_b">
                    <input type="hidden" name="msglist" id="msglist" value="">
                    <input type="submit" class="submit btn" id="submit" value="提 交">
                </div>
            </form>
        </div>
        <div class="form-horizontal">
            <div class="form-item" style="margin-top: 20px;">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".modal1">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 添加规格
                </button>
            </div>

            <div class="form-item" style="margin-top: 20px;">
                <button type="button" class="btn btn-default" data-toggle="modal" data-target=".modal2">上传图片</button>
            </div>

            <div class="form-item">
                <div class="form-inline spec-wrapper" style="padding: 10px 0; margin-bottom: 10px;">
                </div>
                <div style="margin-left: 120px;">
                    <table class="table table-bordered" id="tablist">
                        <thead><tr id="thead"></tr></thead>
                        <tbody id="tbody"></thead>
                    </table>
                </div>
            </div>

            <div class="modal fade bs-example-modal-sm modal1" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
                <div class="modal-dialog" role="document" style="background: #fff;">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <span class="modal-title" id="gridSystemModalLabel">商品规格项目</span>
                    </div>
                    <div class="modal-body">
                        <div class="form-inline">
                            <h4>我的规格</h4>
                            <div class="item" style="padding-bottom: 10px;">
                                <button type="button" class="btn btn-primary btn-sm" id="add-tag">
                                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 添加标签
                                </button>
                            </div>
                            <h4>常规规格</h4>
                            <div class="row-fluid">
                                <button type="button" class="tagChose btn btn-sm btn-default" name="颜色">颜色</button>
                                <button type="button" class="tagChose btn btn-sm btn-default" name="口味">口味</button>
                                <button type="button" class="tagChose btn btn-sm btn-default" name="容量">容量</button>
                                <button type="button" class="tagChose btn btn-sm btn-default" name="套餐">套餐</button>
                                <button type="button" class="tagChose btn btn-sm btn-default" name="种类">种类</button>
                                <button type="button" class="tagChose btn btn-sm btn-default" name="尺寸">尺寸</button>
                                <button type="button" class="tagChose btn btn-sm btn-default" name="重量">重量</button>
                                <button type="button" class="tagChose btn btn-sm btn-default" name="型号">型号</button>
                                <button type="button" class="tagChose btn btn-sm btn-default" name="款式">款式</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary guige-ok" data-dismiss="modal" onclick="init()">确定</button>
                    </div>
                </div>
            </div>

            <div class="modal fade bs-example-modal-sm modal2" tabindex="-1" role="dialog" aria-labelledby="...">
                <div class="modal-dialog" role="document" style="background: #fff;">
                    <div class="modal-header" style="text-align: center;">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <div class="btn-group tab-turn">
                            <button type="button" class="btn btn-default btn-primary">我的图片</button>
                            <button type="button" class="btn btn-default myimgs">图片库</button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="form-inline">
                            <div class="group-classify">
                                <div class="item active">全部</div>
                                <div class="item">组一</div>
                                <div class="item">组二</div>
                                <div class="item">组三</div>
                                <div class="item">组四</div>
                                <div class="item">组五</div>
                            </div>
                        </div>
                        <div class="imgs-wrapper clearfix">
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                            <div class="img-item">
                                <img src="http://read.html5.qq.com/image?src=forum&q=5&r=0&imgflag=7&imageUrl=http://mmbiz.qpic.cn/mmbiz_jpg/XMmU5X1GVzszxia2XBy3FAV4hrDJmmMlAib68rgkbW9pQ7bialnXX5m3YT3TK9WdWKGMJuRLc6NpxIOLCUOAibnQgQ/0?wx_fmt=jpeg">
                                <span class="glyphicon glyphicon-ok remove"></span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer foot-flag">
                        <div class="form-inline">
                            <div class="bottom-wrapper">
                                <button type="button" class="btn btn-info pull-left">上传图片</button>
                                <button type="button" class="btn btn-default pull-left create-group-btn">新建分组</button>
                                <button type="button" class="btn btn-default pull-left group-edit-btn">编辑分组</button>
                                <button type="button" class="btn btn-default pull-left update-btn">批量处理</button>
                                <button type="button" class="btn btn-default pull-right">插入图片</button>
                            </div>
                            <div class="pull-left create-group-box" style=" display: none;">
                                <div class="input-group pull-left" style="width: 220px; margin-right: 10px;">
                                    <div class="input-group-addon">新建分组</div>
                                    <input type="text" class="form-control" placeholder="请输入组名" style="">
                                </div>
                                <button type="button" class="btn btn-success pull-left">确定</button>
                                <button type="button" class="btn btn-default pull-left">取消</button>
                                <span style="color: #666; display: inline-block; padding-top: 10px; font-size: 12px;">组名不超过6个字</span>
                            </div>

                            <div class="pull-left group-edit-box" style=" display: none;">
                                <div class="input-group pull-left" style="width: 220px; margin-right: 10px;">
                                    <div class="input-group-addon">修改组名</div>
                                    <input type="text" class="form-control edit-input" placeholder="请输入组名" style="">
                                </div>
                                <button type="button" class="btn btn-success pull-left">确定</button>
                                <button type="button" class="btn btn-default pull-left">取消</button>
                                <button type="button" class="btn btn-danger pull-left">删除当前组</button>
                                <span style="color: #666; display: inline-block; padding-top: 10px; font-size: 12px;">组名不超过6个字</span>
                            </div>

                            <div class="update-box pull-left" style="display: none;">
                                <span class="pull-left" style="color: #666; display: inline-block; padding-top: 8px; margin-right: 10px;">已选 <label style="color: #0034FF;">0</label> 张 移至</span>
                                <select class="form-control pull-left update-select" style="width: 100px; margin-right: 10px;">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </select>
                                <button type="button" class="btn btn-success pull-left">确定</button>
                                <button type="button" class="btn btn-danger pull-left">删除选中图片</button>
                                <button type="button" class="btn btn-default pull-left">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
        $(function(){
            //主体切换
            $('body').on('click', '.tab-turn button', function () {
                if( $(this).hasClass('myimgs') ){
                    $('.foot-flag').hide();
                }else{
                    $('.foot-flag').show();
                }
                $(this).addClass('btn-primary').siblings().removeClass('btn-primary');
            });

            //分组标题切换
            $('body').on('click', '.group-classify .item', function () {
                $(this).addClass('active').siblings().removeClass('active');
            });

            //图片选择
            var isBatch = false; //是否批量选择
            $('body').on('click', '.img-item', function(){
                if( !isBatch ){
                    $(this).addClass('active').siblings().removeClass('active');
                }else{
                    $(this).toggleClass('active');
                }
            });

            //新建分组
            $('body').on('click', '.create-group-btn', function () {
                $('.bottom-wrapper').hide();
                $('.create-group-box').show();
            });
            $('body').on('click', '.create-group-box .btn-success', function () {
                var name = $('.create-group-box input').val();
                if( name == '' ){
                    alert('组名不能为空');
                    return;
                }
                if( name.length > 6 ){
                    alert('组名不超过6个字');
                    return;
                }
                $('.group-classify').append('<div class="item">'+ name +'</div>');
                $('.create-group-box input').val('');
                $('.create-group-box').hide();
                $('.bottom-wrapper').show();
            });
            $('body').on('click', '.create-group-box .btn-default', function () {
                $('.create-group-box').hide();
                $('.bottom-wrapper').show();
            });

            //编辑分组
            $('body').on('click', '.group-edit-btn', function () {
                var val = $('.group-classify .item.active').html();
                var index = $('.group-classify .item.active').index();
                //如果当前选择为默认分组 则禁止次操作
                if( index == 0 ){
                    alert('不能删除、编辑默认分组');
                    return;
                }
                $('.bottom-wrapper').hide();
                $('.edit-input').val(val);
                $('.group-edit-box').show();
            });
            $('body').on('click', '.group-edit-box .btn-danger', function () {
                if( !confirm('删除分组后分组里的图片不会删除，您确定要删除当前组？') )return;
                $('.group-classify .item.active').remove();
                $('.group-classify .item').eq(0).addClass('active');
                $('.group-edit-box input').val('');

                $('.bottom-wrapper').show();
                $('.group-edit-box').hide();
                alert('删除分组成功');
            });
            $('body').on('click', '.group-edit-box .btn-success', function () {
                var name = $('.group-edit-box input').val();
                if( name == '' ){
                    alert('组名不能为空');
                    return;
                }
                if( name.length > 6 ){
                    alert('组名不超过6个字');
                    return;
                }
                $('.group-classify .item.active').html(name);
                $('.bottom-wrapper').show();
                $('.group-edit-box').hide();
            });
            $('body').on('click', '.group-edit-box .btn-default', function () {
                $('.bottom-wrapper').show();
                $('.group-edit-box').hide();
            });

            //批量处理
            $('body').on('click', '.update-btn', function () {
                //改变批量选择状态
                isBatch = true;
                $('.bottom-wrapper').hide();
                $('.update-box').show();
            });
            $('body').on('click', '.update-box .btn-success, .update-box .btn-default', function () {
                //改变批量选择状态
                isBatch = false;
                $('.bottom-wrapper').show();
                $('.update-box').hide();
            });

            $('body').on('click', '.update-box .btn-danger', function () {
                var len = $('.imgs-wrapper .img-item.active').size();
                if( len == 0 ){
                    alert('您还没有选择要删除的图片哦');
                    return;
                }
                if( !confirm('确认删除吗？') )return;
                $('.imgs-wrapper .img-item.active').remove();
                $('.bottom-wrapper').show();
                $('.update-box').hide();
                alert('删除成功');
            });
        });
        </script>

        <script type="text/javascript">
            //$(function(){
                var thead = [];
                var tbody = [];
                var tagArray = [
                    { name: '口味', arr: ['1-1', '1-2', '1-3']},
                    { name: '重量', arr: ['2-1', '2-2', '2-3']},
                    { name: '型号', arr: ['3-1', '3-2', '3-3']}
                ];

                //2
                var tpl = '<div class="attr-item" style="border: 1px solid #e5e5e5; display: inline-block; padding: 8px; padding-right: 0; border-radius: 5px; margin: 5px;">'+
                                '<div class="input-group input-group-xs input-edit" style=" width: 80px;">'+
                                    '<input type="text" class="form-control" style=" border-radius: 5px;">'+
                                '</div>'+
                                '<label style="margin: 0; margin-right: 6px; display: none;"></label>'+
                                '<div class="btn-group">'+
                                    '<button type="button" class="btn btn-xs btn-default" style=" border: none;">'+
                                        '<span class="glyphicon glyphicon-ok" style="color: #337ab7;"></span>'+
                                    '</button>'+
                                    '<button type="button" class="btn btn-xs btn-default" style=" border: none;">'+
                                        '<span class="glyphicon glyphicon-remove spec-del" style="color: #337ab7;"></span>'+
                                    '</button>'+
                                '</div>'+
                            '</div>';

                //添加类型
                $('body').on('click', '.spec-add', function(){
                    $(this).before('<div class="attr-item" style="border: 1px solid #e5e5e5; display: inline-block; padding: 8px; padding-right: 0; border-radius: 5px; margin: 5px;"><div class="input-group input-group-xs input-edit" style=" width: 80px;"><input type="text" class="form-control" style=" border-radius: 5px;"></div><label style="margin: 0; margin-right: 6px; display: none;"></label><div class="btn-group"><button type="button" class="btn btn-xs btn-default" style=" border: none; display: none;"><span class="glyphicon glyphicon-pencil" style="color: #337ab7;"></span></button><button type="button" class="btn btn-xs btn-default" style=" border: none;"><span class="glyphicon glyphicon-ok" onclick="add_one(this)" style="color: #337ab7;"></span></button><button type="button" class="btn btn-xs btn-default" style=" border: none;"><span class="glyphicon glyphicon-remove spec-del" onclick="del(this)" style="color: #337ab7;"></span></button></div></div>');
                });

                //完成添加 类型
                function add_one(obj, editIndex) {
                    var parent = $(obj).parents('.attr-item');
                    var itemIndex = parent.siblings('.spec-add').attr('addindex');
                    if( parent.find('.input-edit input').val() == '' ){
                        alert('不能为空');
                        return;
                    }
                    //添加到数组
                    console.log(tbody[itemIndex]);
                    if( editIndex == 0 || editIndex){
                        tbody[itemIndex][editIndex] = parent.find('.input-edit input').val();
                        console.log(1);
                    }else if( tbody[itemIndex] ){
                        tbody[itemIndex].push(parent.find('.input-edit input').val());
                        console.log(2);
                    } else {
                        tbody[itemIndex] = [parent.find('.input-edit input').val()];
                        console.log(3);
                    }

                    parent.find('.input-edit').hide();
                    parent.find('label').html(parent.find('.input-edit input').val()).show();
                    parent.find('.glyphicon-ok').parent().hide();
                    parent.find('.glyphicon-pencil').parent().show();

                    createType();
                    createTable();
                }

                //删除 类型
                function del(obj, index1, index2) {
                    var parent = $(obj).parents('.attr-item');
                    if( index1 != null && index2 != null ){
                        if( tbody.length > 1 ){
                            tbody[index1].splice(index2, 1);
                        }else{
                            tbody[index1] = [];
                        }
                        createType();
                        createTable();
                    }else{
                        parent.remove();
                    }
                }


                //3

                //模态框操作
                //$('.modal1').modal('show');

                function init(){
                    createItem();
                }
                //初始化栏目
                function createItem() {
                    $('.spec-wrapper').empty();

                    //初始化 规格
                    if( thead.length == 0 )return;
                    for (var i = 0; i < thead.length; i++) {
                        $('.spec-wrapper').append('<div class="list clearfix" style="margin-bottom: 10px;"><div class="spec-name" style="border: 1px solid #e5e5e5; padding: 8px; padding-right: 0; border-radius: 5px; margin: 10px; float: left;"><label class="name1" style="margin: 0; margin-right: 6px;">'+ thead[i] +'</label><div class="btn-group"><button type="button" class="btn btn-xs btn-default" style=" border: none;"><span class="glyphicon glyphicon-remove" style="color: #337ab7;" onclick="del_item('+ i +')"></span></button></div></div><div class="spec-item" style="border: 1px solid #e5e5e5; border-radius: 5px; padding: 10px; margin-left: 120px;"><button type="button" class="btn btn-default spec-add" addIndex="'+ i +'" style=" display: inline-block; margin: 0 5px; color: #337ab7; border-color: #337ab7;">添加类型</button></div></div>');
                        tbody[i] = [];

                    }

                    createType();

                }

                //创建类型
                function createType() {
                    if(!tbody.length)return;
                    for (var i = 0; i < tbody.length; i++) {
                        $('.list').eq(i).find('.attr-item').remove();
                        for (var j = 0; j < tbody[i].length; j++) {
                            $('.spec-item').eq(i).find('.spec-add').before('<div class="attr-item" style="border: 1px solid #e5e5e5; display: inline-block; padding: 8px; padding-right: 0; border-radius: 5px; margin: 5px;"><div class="input-group input-group-xs input-edit" style=" width: 80px; display: none;"><input type="text" class="form-control" style=" border-radius: 5px;"></div><label style="margin: 0; margin-right: 6px;">'+ tbody[i][j] +'</label><div class="btn-group"><button type="button" class="btn btn-xs btn-default" style=" border: none;"><span class="glyphicon glyphicon-pencil" style="color: #337ab7;" value="'+ tbody[i][j] +'" onclick="edit(this)"></span></button><button type="button" class="btn btn-xs btn-default add_one_edit" style=" border: none; display: none;"><span class="glyphicon glyphicon-ok" style="color: #337ab7;" value="'+ tbody[i][j] +'" onclick="add_one(this, '+ j +')"></span></button><button type="button" class="btn btn-xs btn-default" style=" border: none;"><span class="glyphicon glyphicon-remove spec-del" onclick="del(this, '+ i +', '+ j +')" style="color: #337ab7;"></span></button></div></div>');

                        }
                    }
                }


                function createTable() {
                    $('#thead').empty();
                    $('#tbody').empty();
                    var count = 0;

                    for (var i = 0; i < thead.length; i++) {
                        if( tbody[i].length > 0  ){
                            count++;
                            $('#thead').append('<th>'+ thead[i] +'</th>');
                        }
                    }
                    if( count > 0 ){
                        $('#thead').append('<th>价格：<div class="input-group input-group-xs" style="width: 60px; display: inline-block; vertical-align: middle;"><input type="text" class="form-control" value="40" onkeyup="priceChange(this);" style=" border-radius: 5px;"></div></th>');
                        $('#thead').append('<th>库存：<div class="input-group input-group-xs" style="width: 60px; display: inline-block; vertical-align: middle;"><input type="text" class="form-control" value="40" onkeyup="kucunChange(this)" style=" border-radius: 5px;"></div></th>');
                    }


                    var arr = [];
                    for (var i = 0; i < tbody.length; i++) {
                        if( tbody[i].length > 0 ){
                            arr.push(tbody[i]);
                        }
                    }
                    if( !arr.length )return;
                    var tbodyTags = doExchange(arr);
                    for (var i = 0; i < tbodyTags.length; i++) {
                        var tr = $('<tr></tr>')
                        var s = tbodyTags[i].split(',');
                        if( !s.length )continue;
                        for (var j = 0; j < s.length; j++) {
                            tr.append('<td>' + s[j] + '</td>');
                        }
                        tr.append('<td><div class="input-group input-group-xs" style="width: 60px;"><input type="text" class="form-control price-item" value="40" style=" border-radius: 5px;"></div></td><td><div class="input-group input-group-xs" style="width: 60px;"><input type="text" class="form-control kucun-item" value="40" style=" border-radius: 5px;"></div></td>');
                        $('#tbody').append(tr);
                    }

                }
                var tabArray = [];


                function doExchange(arr){
                    var len = arr.length;
                    // 当数组大于等于2个的时候
                    if(len >= 2){
                        // 第一个数组的长度
                        var len1 = arr[0].length;
                        // 第二个数组的长度
                        var len2 = arr[1].length;
                        // 2个数组产生的组合数
                        var lenBoth = len1 * len2;
                        //  申明一个新数组,做数据暂存
                        var items = new Array(lenBoth);
                        // 申明新数组的索引
                        var index = 0;
                        // 2层嵌套循环,将组合放到新数组中
                        for(var i=0; i<len1; i++){
                            for(var j=0; j<len2; j++){
                                items[index] = arr[0][i] +","+ arr[1][j];
                                index++;
                            }
                        }
                        // 将新组合的数组并到原数组中
                        var newArr = new Array(len -1);
                        for(var i=2;i<arr.length;i++){
                            newArr[i-1] = arr[i];
                        }
                        newArr[0] = items;
                        // 执行回调
                        return doExchange(newArr);
                    }else{
                        return arr[0];
                    }
                }

                //添加我的规格-标签按钮
                $('#add-tag').on('click', function(){
                    var tpl = '<div class="input-group tag-item" style="border: 1px solid #e5e5e5; border-radius: 5px; padding: 6px 8px; margin: 4px; margin-left: 0;">'+
                                '<div class="input-group tag-input-box">'+
                                    '<div class="input-group input-group-sm" style="width: 60px;">'+
                                        '<input type="text" class="form-control" style=" height: 22px;">'+
                                    '</div>'+
                                    '<div class="btn-group" role="group" aria-label="...">'+
                                        '<button type="button" class="btn btn-xs btn-default tagAdd">'+
                                            '<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>'+
                                        '</button>'+
                                        '<button type="button" class="btn btn-xs btn-danger removeTag" style="color: #fff;">'+
                                            '<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>'+
                                        '</button>'+
                                    '</div>'+
                                '</div>'+
                            '</div>';
                    $(this).before(tpl);
                });

                //添加我的规格-确认添加
                $('body').on('click', '.tagAdd', function(){
                    var parent = $(this).parents('.tag-item');
                    if( parent.find('input').val() == '' ){
                        alert('不能为空');
                        return;
                    }
                    parent.after('<button type="button" class="btn btn-sm btn-default tagChose" name="'+ parent.find('input').val() +'">'+ parent.find('input').val() +'</button>');
                    parent.remove();
                });

                //删除我的规格
                $('body').on('click', '.removeTag', function(){
                    $(this).parents('.tag-item').remove();
                });

                //添加/删除 常规规格
                $('body').on('click', '.tagChose', function(){
                    if( !checkLen() ){
                        alert('最多添加3个');
                        return;
                    };
                    var _index = chosed($(this).attr('name'));
                    if( _index == -1 ){
                        thead.push($(this).attr('name'));
                        $(this).addClass('btn-primary');
                    }else{
                        thead.splice(_index, 1);
                        $(this).removeClass('btn-primary');
                    }
                });

                //检测规格数
                function checkLen() {
                    if( thead.length >= 3 ){
                        return false;
                    }
                    return true;
                }

                //删除 已选规格
                function del_item(index) {
                    thead.splice(index, 1);
                    tbody.splice(index, 1);
                    createItem();
                }

                //是否已经被添加
                function chosed(name){
                    var index = -1;
                    for (var i = 0; i < thead.length; i++) {
                        if( thead[i] == name ){
                            return i;
                        }
                    }
                    return index;
                }

                //批量价格修改
                function priceChange(obj) {
                    $('.price-item').val($(obj).val());
                }

                //批量库存修改
                function kucunChange(obj) {
                    $('.kucun-item').val($(obj).val());
                }
            //});
        </script>
    </div>
    <link rel='stylesheet' type="text/css" href="__STATIC__/datetimepicker/jquery.datetimepicker.css" />
    <script type="text/javascript" src="__STATIC__/datetimepicker/jquery.datetimepicker.js"></script>
    <script type="text/javascript">
        $(function () {
            $('#datetimepicker').datetimepicker({
                format: 'Y-m-d H:i'
            });

            $('#checkaccount').click(function () {
            	$('#title').val('');
            	$('#biz').val('');
            	$('#content').val('');
                $('#cover_id_icon').val('');
                $('#msglist').val('');
                $("#cover_id_icon").parent().find('.upload-img-box').html('');

                var account = $('#account').val();
                var url = cleara(SELF) + "&a=ajax_app_detail&account=" + account;
                layer.msg('获取中，请等待...');

                $.get(url, function (res) {
                    if(res.status){
                    	$('#title').val(res.data.title);
                    	$('#biz').val(res.data.biz);
                    	$('#content').val(res.data.desc);
                        $('#cover_id_icon').val(res.data.icon);
                        $('#msglist').val(res.data.msglist);
                        $("#cover_id_icon").parent().find('.upload-img-box').html(
                            '<div class="upload-pre-item"><img src="' + res.data.icon + '"/></div>'
                        );
                    }else{
                        layer.msg(res.info);
                    }
                }, 'json');
            });
        });
    </script>
    <script type="text/javascript" src="__STATIC__/uploadify/jquery.uploadify.min.js"></script>
    <script type="text/javascript">
        /* 初始化上传插件 */
        $(function () {
            $("#upload_picture_icon").uploadify({
                "height": 30,
                "swf": "__STATIC__/uploadify/uploadify.swf",
                "fileObjName": "download",
                "buttonText": "上传图片",
                "uploader": "{:U('File/uploadify',array('session_id'=>session_id()))}",
                "width": 120,
                'multi': false,
                'removeTimeout': 1,
                'fileTypeExts': '*.jpg; *.png; *.gif;',
                "onUploadSuccess": uploadIcon,
                'onFallback': function () {
                    alert('未检测到兼容版本的Flash.');
                }
            });

            function uploadIcon(file, data) {
                var data = $.parseJSON(data);
                var src = '';
                if (data.status) {
                    $("#cover_id_icon").val(data.url);
                    src = data.url || data.savepath;
                    $("#cover_id_icon").parent().find('.upload-img-box').html(
                        '<div class="upload-pre-item"><img src="' + src + '"/></div>'
                    );
                } else {
                    updateAlert(data.info);
                    setTimeout(function () {
                        $('#top-alert').find('button').click();
                        $(that).removeClass('disabled').prop('disabled', false);
                    }, 1500);
                }
            }

            $("#upload_picture_qrcode").uploadify({
                "height": 30,
                "swf": "__STATIC__/uploadify/uploadify.swf",
                "fileObjName": "download",
                "buttonText": "上传图片",
                "uploader": "{:U('File/uploadify',array('session_id'=>session_id()))}",
                "width": 120,
                'multi': false,
                'removeTimeout': 1,
                'fileTypeExts': '*.jpg; *.png; *.gif;',
                "onUploadSuccess": uploadQrcode,
                'onFallback': function () {
                    alert('未检测到兼容版本的Flash.');
                }
            });

            function uploadQrcode(file, data) {
                var data = $.parseJSON(data);
                var src = '';
                if (data.status) {
                    $("#cover_id_qrcode").val(data.url);
                    src = data.url || data.savepath;
                    $("#cover_id_qrcode").parent().find('.upload-img-box').html(
                        '<div class="upload-pre-item"><img src="' + src + '"/></div>'
                    );
                } else {
                    updateAlert(data.info);
                    setTimeout(function () {
                        $('#top-alert').find('button').click();
                        $(that).removeClass('disabled').prop('disabled', false);
                    }, 1500);
                }
            }
        });
    </script>

</block>

